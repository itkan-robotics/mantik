{
  "title": "PID Control",
  "sections": [
    {
      "type": "text",
      "title": "Overview",
      "content": "PID (Proportional-Integral-Derivative) is a feedback loop that corrects errors. It drives a mechanism to a target setpoint (like an elevator height or shooter speed) by adjusting motor output."
    },
    {
      "type": "text",
      "title": "The Terms",
      "content": "<strong>P (Proportional):</strong> Reacts to current error. \"I'm far away, go fast.\" Main driver of motion.<br><strong>I (Integral):</strong> Reacts to accumulated error. \"I've been close for a while, push harder.\" Fixes steady-state error (e.g., gravity).<br><strong>D (Derivative):</strong> Reacts to rate of change. \"I'm closing in fast, slow down.\" Dampens oscillation."
    },
    {
      "type": "rules-box",
      "title": "Implementation Methods",
      "subtitle": "Where to run PID:",
      "items": [
        "<strong>On-RIO (WPILib PIDController):</strong> Runs in user code (20ms loop). Flexible, easy to debug.",
        "<strong>On-Controller (Spark/Talon):</strong> Runs on motor controller (1ms loop). Faster, frees up RIO CPU."
      ]
    },
    {
      "type": "text",
      "title": "WPILib PIDController",
      "content": "Best for learning and complex logic."
    },
    {
      "type": "code",
      "title": "RIO PID Example",
      "content": "package frc.robot.subsystems;\n\nimport edu.wpi.first.wpilibj2.command.SubsystemBase;\nimport edu.wpi.first.math.controller.PIDController;\n\npublic class Elevator extends SubsystemBase {\n    // Create PID controller: kP, kI, kD\n    private PIDController pid = new PIDController(0.5, 0.0, 0.0);\n    \n    // Example: encoder and motor would be defined elsewhere\n    // private Encoder encoder;\n    // private Motor motor;\n    private double targetHeight = 0.0;\n    \n    // ... (other methods and fields)\n    \n    @Override\n    public void periodic() {\n        // Calculate PID output: current position vs target\n        double currentPosition = encoder.getPosition();\n        double output = pid.calculate(currentPosition, targetHeight);\n        \n        // Apply output to motor\n        motor.set(output);\n    }\n    \n    // ... (rest of class)"
    },
    {
      "type": "text",
      "title": "On-Controller PID",
      "content": "Best for performance."
    },
    {
      "type": "code-tabs",
      "title": "Hardware PID",
      "content": "Configuration:",
      "tabs": [
        {
          "label": "Talon FX",
          "code": "package frc.robot.subsystems;\n\nimport com.ctre.phoenix6.configs.Slot0Configs;\nimport com.ctre.phoenix6.controls.PositionVoltage;\nimport com.ctre.phoenix6.hardware.TalonFX;\n\npublic class Example {\n    private TalonFX motor = new TalonFX(1);\n    \n    public void configurePID() {\n        // Configure PID gains for Slot 0\n        Slot0Configs config = new Slot0Configs();\n        config.kP = 0.1;  // Proportional gain\n        config.kI = 0.0;  // Integral gain\n        config.kD = 0.01; // Derivative gain\n        motor.getConfigurator().apply(config);\n    }\n    \n    public void setPosition(double targetRotations) {\n        // Use position control with configured PID\n        motor.setControl(new PositionVoltage(targetRotations));\n    }\n}"
        },
        {
          "label": "SPARK MAX",
          "code": "package frc.robot.subsystems;\n\nimport com.revrobotics.spark.SparkMax;\nimport com.revrobotics.spark.SparkLowLevel.MotorType;\nimport com.revrobotics.spark.config.SparkMaxConfig;\nimport com.revrobotics.spark.SparkBase.ResetMode;\nimport com.revrobotics.spark.SparkBase.PersistMode;\nimport com.revrobotics.spark.ClosedLoopController.ControlType;\n\npublic class Example {\n    private SparkMax motor = new SparkMax(1, MotorType.kBrushless);\n    private SparkClosedLoopController controller = motor.getClosedLoopController();\n    \n    public void configurePID() {\n        // Configure PID gains\n        SparkMaxConfig config = new SparkMaxConfig();\n        config.closedLoop.p(0.1).i(0.0).d(0.01);\n        motor.configure(config, ResetMode.kResetSafeParameters, PersistMode.kPersistParameters);\n    }\n    \n    public void setPosition(double target) {\n        // Use position control with configured PID\n        controller.setReference(target, ControlType.kPosition);\n    }\n}"
        }
      ]
    },
    {
      "type": "text",
      "title": "Tuning Process",
      "content": "Tune feedforward first, then PID. Use Phoenix Tuner or similar tools for quick constant changes. Log desired vs actual position using a vendor-specific tool (Phoenix Tuner, REV Hardware Client) or an external tool (AdvantageScope, Elastic) to see system behavior. (Credits to <a href='https://www.chiefdelphi.com/t/frc-3255-supernurds-2025-build-thread/477499/116'>SuperNURDS FRC 3255</a> for the original method)"
    },
    {
      "type": "rules-box",
      "title": "Feedforward Tuning",
      "subtitle": "Steps:",
      "items": [
        "Set all PID constants to 0.",
        "Command the mechanism to a non-zero position.",
        "Manually raise to that position and release.",
        "Observe if it holds, raises, or falls.",
        "Adjust kG (gravity feedforward) and repeat until it holds position."
      ]
    },
    {
      "type": "rules-box",
      "title": "PID Tuning",
      "subtitle": "Steps:",
      "items": [
        "Log desired position and actual position.",
        "Slowly increase kP until you see overshoot, then set kP slightly below that value.",
        "(For a riskier strategy, double kP until you see overshoot, then set kP to the midpoint between the old and current kP values until oscillation mostly disappears)",
        "If steady-state error appears (doesn't reach target), increase kS (static feedforward) slightly.",
        "This makes kP temporarily too large (overshoot), but your final kP will be close.",
        "Repeat adjusting kS and kP until properly tuned."
      ]
    },
    {
      "type": "link-grid",
      "title": "Resources",
      "links": [
        {
          "label": "Trapezoidal Motion Profiling",
          "id": "trapezoidal-motion-profiling"
        },
        {
          "label": "WPILib PID",
          "url": "https://docs.wpilib.org/en/stable/docs/software/advanced-controls/controllers/pidcontroller.html"
        },
        {
          "label": "Mechanism PID Tuning Practice",
          "url": "https://docs.wpilib.org/en/stable/docs/software/advanced-controls/introduction/tutorial-intro.html"
        }
      ]
    }
  ]
}