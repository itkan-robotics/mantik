{
  "title": "On-Controller PID",
  "sections": [
    {
      "type": "text",
      "title": "Overview",
      "content": "Running PID on the motor controller (1kHz loop) is faster and smoother than on the RIO (50Hz). It frees up CAN bus bandwidth and RIO CPU."
    },
    {
      "type": "text",
      "title": "PID Slots",
      "content": "Controllers have 'Slots' (0, 1, 2...) to store different PID gains. Example: Slot 0 for Position, Slot 1 for Velocity."
    },
    {
      "type": "code-tabs",
      "title": "Configuring PID",
      "content": "Setting gains:",
      "tabs": [
        {
          "label": "Talon FX",
          "code": "package frc.robot.subsystems;\n\nimport com.ctre.phoenix6.hardware.TalonFX;\nimport com.ctre.phoenix6.configs.TalonFXConfiguration;\n\npublic class Elevator extends SubsystemBase {\n    private TalonFX motor = new TalonFX(1);\n    \n    // ... (other fields and methods)\n    \n    public void configurePID() {\n        TalonFXConfiguration config = new TalonFXConfiguration();\n        \n        // Configure Slot 0 for position control\n        config.Slot0.kP = 0.1;  // Proportional gain\n        config.Slot0.kI = 0.0;  // Integral gain\n        config.Slot0.kD = 0.01; // Derivative gain\n        \n        // Configure Slot 1 for velocity control\n        config.Slot1.kP = 0.05; // Proportional gain\n        config.Slot1.kV = 0.12;  // Velocity feedforward\n        \n        motor.getConfigurator().apply(config);\n    }\n    \n    // ... (rest of class)"
        },
        {
          "label": "SPARK MAX",
          "code": "package frc.robot.subsystems;\n\nimport com.revrobotics.spark.SparkMax;\nimport com.revrobotics.spark.SparkLowLevel.MotorType;\nimport com.revrobotics.spark.config.SparkMaxConfig;\nimport com.revrobotics.spark.ClosedLoopController.ClosedLoopSlot;\nimport com.revrobotics.spark.SparkBase.ResetMode;\nimport com.revrobotics.spark.SparkBase.PersistMode;\n\npublic class Elevator extends SubsystemBase {\n    private SparkMax motor = new SparkMax(1, MotorType.kBrushless);\n    \n    // ... (other fields and methods)\n    \n    public void configurePID() {\n        SparkMaxConfig config = new SparkMaxConfig();\n        \n        // Configure Slot 0 for position control\n        config.closedLoop.p(0.1, ClosedLoopSlot.kSlot0);\n        config.closedLoop.d(0.01, ClosedLoopSlot.kSlot0);\n        \n        // Configure Slot 1 for velocity control\n        config.closedLoop.p(0.05, ClosedLoopSlot.kSlot1);\n        config.closedLoop.i(0.0, ClosedLoopSlot.kSlot1);\n        \n        motor.configure(config, ResetMode.kResetSafeParameters, PersistMode.kPersistParameters);\n    }\n    \n    // ... (rest of class)"
        }
      ]
    },
    {
      "type": "code-tabs",
      "title": "Controlling",
      "content": "Setting targets:",
      "tabs": [
        {
          "label": "Talon FX",
          "code": "package frc.robot.subsystems;\n\nimport com.ctre.phoenix6.hardware.TalonFX;\nimport com.ctre.phoenix6.controls.PositionVoltage;\nimport com.ctre.phoenix6.controls.VelocityVoltage;\n\npublic class Elevator extends SubsystemBase {\n    private TalonFX motor = new TalonFX(1);\n    \n    // ... (other fields and methods)\n    \n    public void setPosition(double targetRotations) {\n        // Use Slot 0 for position control\n        motor.setControl(new PositionVoltage(targetRotations).withSlot(0));\n    }\n    \n    public void setVelocity(double targetRPS) {\n        // Use Slot 1 for velocity control\n        motor.setControl(new VelocityVoltage(targetRPS).withSlot(1));\n    }\n    \n    // ... (rest of class)"
        },
        {
          "label": "SPARK MAX",
          "code": "package frc.robot.subsystems;\n\nimport com.revrobotics.spark.SparkMax;\nimport com.revrobotics.spark.SparkLowLevel.MotorType;\nimport com.revrobotics.spark.ClosedLoopController;\nimport com.revrobotics.spark.ClosedLoopController.ControlType;\nimport com.revrobotics.spark.ClosedLoopController.ClosedLoopSlot;\n\npublic class Elevator extends SubsystemBase {\n    private SparkMax motor = new SparkMax(1, MotorType.kBrushless);\n    private SparkClosedLoopController pid = motor.getClosedLoopController();\n    \n    // ... (other fields and methods)\n    \n    public void setPosition(double targetRotations) {\n        // Use Slot 0 for position control\n        pid.setReference(targetRotations, ControlType.kPosition, ClosedLoopSlot.kSlot0);\n    }\n    \n    public void setVelocity(double targetRPM) {\n        // Use Slot 1 for velocity control\n        pid.setReference(targetRPM, ControlType.kVelocity, ClosedLoopSlot.kSlot1);\n    }\n    \n    // ... (rest of class)"
        }
      ]
    },
    {
      "type": "link-grid",
      "title": "Related",
      "links": [
        {
          "label": "Motion Profiling",
          "id": "motor-motion-profiling"
        },
        {
          "label": "PID Overview",
          "id": "pid-control"
        }
      ]
    }
  ]
}
